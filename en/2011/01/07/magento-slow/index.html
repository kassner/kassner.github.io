<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta charset="UTF-8"><title>Magento slow | Rafael Kassner</title><meta name="robots" content="index,follow"/><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://www.kassner.com.br/atom.xml"/><link rel="canonical" href="https://www.kassner.com.br/en/2011/01/07/magento-slow/"/><link rel="stylesheet" href="https://www.kassner.com.br/assets/css/main.css"/></head><body class="post"><div class="background"></div><div id="wrapper"> <header> <nav id="site-navigation" class="main-navigation" role="navigation"> <label for="drop" class="toggle">Menu</label> <input type="checkbox" id="drop"/><ul id="primary-menu" class="menu"><li class="menu-item"><a href="https://www.kassner.com.br">Rafael Kassner</a></li><li class="menu-item"><a href="https://www.kassner.com.br/projects/">Projects</a></li><li class="menu-item"><a href="https://www.kassner.com.br/about/">About</a></li></ul> </nav> </header><div class="pull-down"></div><div class="container"><div id="primary" class="content-area"> <main id="main" class="site-main" role="main"> <article lang="en" class="post type-post status-publish format-standard hentry"><h1 class="article-header"><a href="https://www.kassner.com.br/en/2011/01/07/magento-slow/">Magento slow</a></h1><div class="entry-meta"><div class="byline"> <span class="posted-on"><time class="entry-date published" datetime="2011-01-07T00:00:00+00:00">2011-01-07</time></span> <span class="language">English</span></div></div><div class="entry-content"><p>Hello.</p><p>After an intense debug into Magento, we (<a href="http://www.ibaldo.com.br/">Filipe Ibaldo</a> and me) have found two problems in Magento code, related to slow Place Order with many products in cart (not many qty of a product).</p><p>One of the problems is the order item save, which is executed precisely in <code class="language-plaintext highlighter-rouge">app/code/core/Mage/Sales/Model/Entity/Order/Attribute/Backend/Parent.php</code>, on afterSave method, who spent many time on my machine (Core 2 Duo 2.26/4GB RAM), about 0.3 second for each product.</p><p>Considering the number of items average of customer’s cart is about 50 distinct products, this time, adding to another code executions and a high server load, is easily more than one minute, and this is unacceptable.</p><p>The found workaround is disable some observers from <code class="language-plaintext highlighter-rouge">Mage_Downloadable</code> and <code class="language-plaintext highlighter-rouge">Mage_Rss</code>, who execute in afterSave of each item in order.</p><p>In <code class="language-plaintext highlighter-rouge">app/code/core/Mage/Downloadable/etc/config.xml</code>, remove/comment the following lines:</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;sales_order_item_save_commit_after&gt;</span>
    <span class="nt">&lt;observers&gt;</span>
        <span class="nt">&lt;downloadable_observer&gt;</span>
            <span class="nt">&lt;class&gt;</span>downloadable/observer<span class="nt">&lt;/class&gt;</span>
            <span class="nt">&lt;method&gt;</span>saveDownloadableOrderItem<span class="nt">&lt;/method&gt;</span>
        <span class="nt">&lt;/downloadable_observer&gt;</span>
    <span class="nt">&lt;/observers&gt;</span>
<span class="nt">&lt;/sales_order_item_save_commit_after&gt;</span>
</code></pre></div></div><p>The code above appears twice.</p><p>In <code class="language-plaintext highlighter-rouge">app/code/core/Mage/Rss/etc/config.xml</code>, remove/comment the following lines:</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;sales_order_save_after&gt;</span>
    <span class="nt">&lt;observers&gt;</span>
        <span class="nt">&lt;notifystock&gt;</span>
            <span class="nt">&lt;class&gt;</span>rss/observer<span class="nt">&lt;/class&gt;</span>
            <span class="nt">&lt;method&gt;</span>salesOrderItemSaveAfterNotifyStock<span class="nt">&lt;/method&gt;</span>
        <span class="nt">&lt;/notifystock&gt;</span>
    <span class="nt">&lt;/observers&gt;</span>
<span class="nt">&lt;/sales_order_save_after&gt;</span>
<span class="nt">&lt;sales_order_save_after&gt;</span>
    <span class="nt">&lt;observers&gt;</span>
        <span class="nt">&lt;ordernew&gt;</span>
            <span class="nt">&lt;class&gt;</span>rss/observer<span class="nt">&lt;/class&gt;</span>
            <span class="nt">&lt;method&gt;</span>salesOrderItemSaveAfterOrderNew<span class="nt">&lt;/method&gt;</span>
        <span class="nt">&lt;/ordernew&gt;</span>
    <span class="nt">&lt;/observers&gt;</span>
<span class="nt">&lt;/sales_order_save_after&gt;</span>
</code></pre></div></div><p>With this workaround, the save time of each product went from 0.3 second to 0.001 second, an incredible speed improvement.</p><p>However, if you are using downloadable products or Magento Inventory Management, this modifications can broke related features, so, be careful.</p><p>Another problem found is related with module disable feature into System &gt; Configuration &gt; Advanced &gt; Advanced &gt; Disable Module Output. If you disable some module, their observers did not disabled, and you need to remove their configuration or delete module folder.</p><p>Bye.</p></div><div class="entry-footer"><p class="cat-links">Posted in <a href="/tags/php/" rel="tag">php</a>, <a href="/tags/magento/" rel="tag">magento</a>, <a href="/tags/performance/" rel="tag">performance</a></p></div> </article> </main></div></div></div><footer><div class="footer-content"></div><div class="footer"><div><div> <span class="copy">Copyright © 2010-2021 Rafael Kassner</span></div></div></div> </footer></body></html>